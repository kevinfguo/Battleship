var gameLogic;!function(a){function b(){return{gameBoard:[[["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""]],[["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""]],[["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""]],[["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""]]],phase:0}}function c(a){return a.phase}function d(a){return 0==a||5==a?5:1==a||6==a?4:2==a||3==a||7==a||8==a?3:4==a||9==a?2:void 0}function e(a){for(var b=!0,c=!0,d=0;10>d;d++)for(var e=0;10>e;e++){var f=a.gameBoard[3][d][e],g=a.gameBoard[0][d][e];"X"==f&&"O"!=g&&(b=!1)}for(var d=0;10>d;d++)for(var e=0;10>e;e++){var f=a.gameBoard[2][d][e],g=a.gameBoard[1][d][e];"X"==f&&"O"!=g&&(c=!1)}return b?"P1":c?"P2":""}function f(a,c,f,g,h){if(a||(a=b()),0===a.phase||1===a.phase||2===a.phase||3===a.phase||4===a.phase){var i=angular.copy(a),j={setTurn:{turnIndex:0}},k={row:c,col:f,direction:g};if(0==g)for(var l=0;l<d(a.phase);l++)i.gameBoard[2+h][c][f+l]="X";else if(1==g)for(var l=0;l<d(a.phase);l++)i.gameBoard[2+h][c+l][f]="X";else if(2==g)for(var l=0;l<d(a.phase);l++)i.gameBoard[2+h][c][f-l]="X";else if(3==g)for(var l=0;l<d(a.phase);l++)i.gameBoard[2+h][c-l][f]="X";return i.phase=a.phase+1,5==i.phase&&(j={setTurn:{turnIndex:1}}),[j,{set:{key:"board",value:i}},{set:{key:"delta",value:k}}]}if(5===a.phase||6===a.phase||7===a.phase||8===a.phase||9===a.phase){var i=angular.copy(a),j={setTurn:{turnIndex:1}},k={row:c,col:f,direction:g},m=!0;if(0==g){for(var l=0;l<d(a.phase);l++)if("X"==i.gameBoard[2+h][c][f+l])throw new Error("A ship is already here!");if(m)for(var l=0;l<d(a.phase);l++)i.gameBoard[2+h][c][f+l]="X"}else if(1==g){for(var l=0;l<d(a.phase);l++)if("X"==i.gameBoard[2+h][c+l][f])throw new Error("A ship is already here!");if(m)for(var l=0;l<d(a.phase);l++)i.gameBoard[2+h][c+l][f]="X"}else if(2==g){for(var l=0;l<d(a.phase);l++)if("X"==i.gameBoard[2+h][c][f-l])throw new Error("A ship is already here!");if(m)for(var l=0;l<d(a.phase);l++)i.gameBoard[2+h][c][f-l]="X"}else if(3==g){for(var l=0;l<d(a.phase);l++)if("X"==i.gameBoard[2+h][c-l][f])throw new Error("A ship is already here!");if(m)for(var l=0;l<d(a.phase);l++)i.gameBoard[2+h][c-l][f]="X"}return i.phase=a.phase+1,10==i.phase&&(j={setTurn:{turnIndex:0}}),[j,{set:{key:"board",value:i}},{set:{key:"delta",value:k}}]}if(""!==a.gameBoard[h][c][f])throw new Error("One can only make a move in an empty position!");if(""!==e(a,h))throw new Error("Can only make a move if the game is not over!");var i=angular.copy(a);i.gameBoard[h][c][f]="X"===i.gameBoard[3-h][c][f]?"O":"X";var j,n=e(i,h);""!==n?(log.info("Game over! Winner is: ",n),j={endMatch:{endMatchScores:"P1"===n?[1,0]:[0,1]}}):j={setTurn:{turnIndex:1-h}};var k={row:c,col:f,direction:g};return[j,{set:{key:"board",value:i}},{set:{key:"delta",value:k}}]}function g(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{var e=b[2].set.value,g=e.row,h=e.col,i=e.direction,j=d.board,k=f(j,g,h,i,c);if(!angular.equals(b,k))return!1}catch(l){return!1}return!0}a.ROWS=10,a.COLS=10,a.getInitialBoard=b,a.getGamePhase=c,a.getShipLength=d,a.createMove=f,a.isMoveOk=g}(gameLogic||(gameLogic={}));var game;!function(a){function b(){console.log("Translation of 'RULES_OF_BATTLESHIP' is "+translate("RULES_OF_BATTLESHIP")),resizeGameAreaService.setWidthToHeight(2),gameService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:gameLogic.isMoveOk,updateUI:k}),document.addEventListener("animationend",i,!1),document.addEventListener("webkitAnimationEnd",i,!1),document.addEventListener("oanimationend",i,!1),dragAndDropService.addDragListener("boardArea",c)}function c(a,b,c){if(x=document.getElementById("boardArea"),y=document.getElementById("gameArea"),z=document.getElementById("draggingLines"),A=document.getElementById("verticalDraggingLine"),B=document.getElementById("horizontalDraggingLine"),C=null,t){var h=b-y.offsetLeft,i=c-Math.floor(x.offsetTop+.05*x.offsetTop);if(0>h||0>i||h>=x.clientWidth||i>=x.clientHeight)return void(z.style.display="none");z.style.display="inline";var j=Math.floor(H*h/x.clientWidth),k=Math.floor(G*i/x.clientHeight),m=g(k,j);A.setAttribute("x1",String(m.x)),A.setAttribute("x2",String(m.x)),B.setAttribute("y1",String(m.y)),B.setAttribute("y2",String(m.y));var n=0;j>9&&(j-=10,n=1);var o=gameLogic.getGamePhase(w.board);if(10>o){var p=gameLogic.getShipLength(o);"touchstart"===a?(I=0,F=n,D=k,E=j,d(p,n,D,E,I)&&f(p,n,k,j,I)):"touchmove"===a?(k>D?I=1:j>E?I=0:E>j?I=2:D>k&&(I=3),e(),d(p,n,D,E,I)&&f(p,n,D,E,I)):("touchend"===a||"touchcancel"===a||"touchleave"===a||"mouseup"===a)&&(z.style.display="none",d(p,n,D,E,I)&&l(D,E,n,I,o))}else("touchend"===a||"touchcancel"===a||"touchleave"===a||"mouseup"===a)&&(z.style.display="none",l(k,j,n,I,o))}}function d(a,b,c,d,e){var f=gameLogic.getGamePhase(w.board);if(b!=F||5>f&&0!=b||f>4&&10>f&&1!=b)return!1;if(0==e){if(10>=d+a){for(var g=0;a>g;g++)if(q(c,d+g,b,f))return!1;return!0}}else if(1==e){if(10>=c+a){for(var g=0;a>g;g++)if(q(c+g,d,b,f))return!1;return!0}}else if(2==e){if(d-a>=-1){for(var g=0;a>g;g++)if(q(c,d-g,b,f))return!1;return!0}}else if(3==e&&c-a>=-1){for(var g=0;a>g;g++)if(q(c-g,d,b,f))return!1;return!0}return!1}function e(){var b=gameLogic.getGamePhase(w.board);if(5>b)for(var c=0;2>c;c++)for(var d=0;10>d;d++)for(var e=0;10>e;e++)document.getElementById("e2e_test_div_"+c+":"+d+"x"+e).style.backgroundColor=a.isBattleship(d,e,c,b)?"grey":"#89CFF0";else if(10>b)for(var c=0;2>c;c++)for(var d=0;10>d;d++)for(var e=0;10>e;e++)document.getElementById("e2e_test_div_"+c+":"+d+"x"+e).style.backgroundColor=0==c?"#89CFF0":a.isBattleship(d,e,c,b)?"grey":"#89CFF0";else for(var c=0;2>c;c++)for(var d=0;10>d;d++)for(var e=0;10>e;e++)document.getElementById("e2e_test_div_"+c+":"+d+"x"+e).style.backgroundColor="#89CFF0"}function f(a,b,c,d,e){if(0==e)for(var f=0;a>f;f++)C=document.getElementById("e2e_test_div_"+b+":"+c+"x"+(d+f)),C.style.backgroundColor="grey";else if(1==e)for(var f=0;a>f;f++)C=document.getElementById("e2e_test_div_"+b+":"+(c+f)+"x"+d),C.style.backgroundColor="grey";else if(2==e)for(var f=0;a>f;f++)C=document.getElementById("e2e_test_div_"+b+":"+c+"x"+(d-f)),C.style.backgroundColor="grey";else if(3==e)for(var f=0;a>f;f++)C=document.getElementById("e2e_test_div_"+b+":"+(c-f)+"x"+d),C.style.backgroundColor="grey"}function g(a,b){var c=h();return{x:b*c.width+c.width/2,y:a*c.height+c.height/2}}function h(){return{width:x.clientWidth/H,height:x.clientHeight/G}}function i(){$rootScope.$apply(function(){log.info("Animation ended"),s=!0})}function j(){gameService.makeMove(aiService.findComputerMove(v))}function k(a){log.info("Game got updateUI:",a),s=!1,v=a,w=a.stateAfterMove,w.board||(w.board=gameLogic.getInitialBoard()),t=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove,u=t&&""===a.playersInfo[a.yourPlayerIndex].playerId,u&&(t=!1,j()),null!=w&&gameLogic.getGamePhase(w.board)>0&&e()}function l(a,b,c,d,e){if(log.info("Clicked on board:",c,"Clicked on cell:",a,b),"?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(!(!t||10==e&&v.turnIndexAfterMove!=1-c||10>e&&v.turnIndexAfterMove!=c))try{var f=gameLogic.createMove(w.board,a,b,d,v.turnIndexAfterMove);t=!1,gameService.makeMove(f)}catch(g){return void log.info(["Cell is already full in position:",a,b])}}function m(a,b,c){var d=w.board.gameBoard[1-c][a][b];return""!==d}function n(a,b,c){return"X"===w.board.gameBoard[1-c][a][b]}function o(a,b,c){return"O"===w.board.gameBoard[1-c][a][b]}function p(a,b){return!s&&w.delta&&w.delta.row===a&&w.delta.col===b}function q(a,b,c,d){return 10==d&&v.turnIndexBeforeMove!=1-c||u?!1:"X"===w.board.gameBoard[2+c][a][b]}function r(a,b,c){return v.turnIndexBeforeMove!=1-c||u?!1:"X"===w.board.gameBoard[2+c][a][b]}var s=!1,t=!1,u=!1,v=null,w=null;a.isHelpModalShown=!1;var x,y,z,A,B,C,D,E,F,G=10,H=20,I=0;a.init=b,a.handleDragEvent=c,a.cellClicked=l,a.shouldShowImage=m,a.isPieceX=n,a.isPieceO=o,a.shouldSlowlyAppear=p,a.isBattleship=q,a.isABattleship=r}(game||(game={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).run(function(){$rootScope.game=game,translate.setLanguage("en",{RULES_OF_BATTLESHIP:"Rules of Battleship",RULES_SLIDE1:"First, you and your opponent place your 5 battleships on your own board.",RULES_SLIDE2:"You and your opponent then take turns to fire upon the enemy board. If you hit an enemy battleship, you will score a X. If you miss, you will score a O.",RULES_SLIDE3:"The first player to eliminate all opposing battleships is declared the winner.",CLOSE:"Close"}),game.init()});var aiService;!function(a){function b(a){return g(a.stateAfterMove.board,a.turnIndexAfterMove,{millisecondsLimit:1e3})}function c(a,b){for(var c=[],d=0;d<gameLogic.ROWS;d++)for(var e=0;e<gameLogic.COLS;e++)try{c.push(gameLogic.createMove(a,d,e,1,b))}catch(f){}return c}function d(a,b){for(var c=[],d=[],f=0,g=0;g<a.length;g++)c[g]=e(a[g],b),c[g]==f?d.push(a[g]):c[g]>f&&(d=[],d.push(a[g]));var h=Math.floor(Math.random()*d.length);return d[h]}function e(a,b){var c=0,d=a[1].set.value,e=a[2].set.value,g=e.row,h=e.col;return c+=f(d,g+1,h,b),c+=f(d,g-1,h,b),c+=f(d,g,h+1,b),c+=f(d,g,h-1,b)}function f(a,b,c,d){return b>9||c>9||0>b||0>c?0:"O"===a.gameBoard[d][b][c]?1:0}function g(a,b){return h(c(a,b))}function h(a){var b,c=Math.floor(Math.random()*a.length);return b=a[c],log.info(b),b}a.findComputerMove=b,a.getPossibleMoves=c,a.scoreMoves=d,a.getScoredMove=e,a.createComputerMove=g,a.randomGuess=h}(aiService||(aiService={}));
//# sourceMappingURL=everything.min.js.map